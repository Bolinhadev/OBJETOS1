<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detecção Múltipla com Modelos TensorFlow.js</title>
    <style>
        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f0f0; }
        #container { position: relative; }
        video, canvas { position: absolute; top: 0; left: 0; }
    </style>
</head>
<body>
    <div id="container">
        <video id="video" width="640" height="480" autoplay muted></video>
        <canvas id="canvas" width="640" height="480"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet"></script>
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let cocoSsdModel, mobilenetModel, blazefaceModel, handposeModel, posenetModel;

        async function setupCamera() {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480 } });
            video.srcObject = stream;
            return new Promise(resolve => {
                video.onloadedmetadata = () => {
                    video.play();
                    resolve();
                };
            });
        }

        async function loadModels() {
            cocoSsdModel = await cocoSsd.load();
            mobilenetModel = await mobilenet.load();
            blazefaceModel = await blazeface.load();
            handposeModel = await handpose.load();
            posenetModel = await posenet.load();
        }

        async function detectAndClassify() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            // COCO-SSD detection
            const cocoDetections = await cocoSsdModel.detect(video);
            cocoDetections.forEach(detection => {
                drawBox(detection.bbox, 'red', `${detection.class} (${Math.round(detection.score * 100)}%)`);
            });

            // MobileNet classification
            const mobilenetClassification = await mobilenetModel.classify(video);
            if (mobilenetClassification.length > 0) {
                const topPrediction = mobilenetClassification[0];
                drawText(`MobileNet: ${topPrediction.className} (${Math.round(topPrediction.probability * 100)}%)`, 10, canvas.height - 10, 'blue');
            }

            // BlazeFace detection
            const blazefaceDetections = await blazefaceModel.estimateFaces(video, false);
            blazefaceDetections.forEach(face => {
                drawBox([face.topLeft[0], face.topLeft[1], face.bottomRight[0] - face.topLeft[0], face.bottomRight[1] - face.topLeft[1]], 'green', 'Face');
            });

            // HandPose detection
            const hands = await handposeModel.estimateHands(video);
            hands.forEach(hand => {
                const palmBase = hand.landmarks[0];
                drawPoint(palmBase[0], palmBase[1], 'yellow', 'Hand');
            });

            // PoseNet detection
            const pose = await posenetModel.estimateSinglePose(video);
            pose.keypoints.forEach(keypoint => {
                if (keypoint.score > 0.5) {
                    drawPoint(keypoint.position.x, keypoint.position.y, 'purple', keypoint.part);
                }
            });

            requestAnimationFrame(detectAndClassify);
        }

        function drawBox(bbox, color, label) {
            const [x, y, width, height] = bbox;
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, width, height);
            drawText(label, x, y - 5, color);
        }

        function drawPoint(x, y, color, label) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, 2 * Math.PI);
            ctx.fill();
            drawText(label, x, y - 5, color);
        }

        function drawText(text, x, y, color) {
            ctx.fillStyle = color;
            ctx.font = '16px Arial';
            ctx.fillText(text, x, y);
        }

        async function start() {
            await setupCamera();
            await loadModels();
            detectAndClassify();
        }

        start();
    </script>
</body>
</html>
